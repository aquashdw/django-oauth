{% extends 'base.html' %}

{% block content %}
<section class="block mt-6 px-6">
  <div class="level is-mobile">
    <div class="level-left">
      <div class="level-item">
        <p class="title is-1">{{ client.name }}</p>
      </div>
      <div class="level-item">
        <button class="tag is-info" id="rename-client-modal-button" data-modal-target="rename-client-modal">Rename</button>
      </div>
    </div>
    <div class="level-right"><a href="{% url 'oauth:index' %}">Back</a></div>
  </div>
  <p class="subtitle">Status: <span class="tag is-warning">{{ client.get_status_display }}</span></p>
</section>
<hr>
<section class="columns">
  <div class="column">
    <section class="mx-5 has-text-centered">
      <h2 class="title mb-2">Callback URLs</h2>
      <p class="subtitle">URLs to notify user's approval</p>
      <form class="mb-3">
        <div class="field has-addons">
          <div class="control is-expanded">
            <input class="input" type="url" name="url" required>
          </div>
          <div class="control">
            <button class="button is-info">Add</button>
          </div>
        </div>
      </form>
      {% if client.callback_urls|length %}
      <table class="table has-text-centered">
        <thead>
          <th>Callback URLs</th>
          <td>Action</td>
        </thead>
        <tbody>
          {% for url in client.callback_urls.all %}
          <tr>
            <td>{{ url }}</td>
            <td><button class="tag is-danger">Delete</button></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="is-size-5 has-text-warning">No Callback URLs set</h3>
      {% endif %}
    </section>
  </div>
  <div class="column">
    <section class="mx-5 has-text-centered">
      <h2 class="title mb-2">Testers</h2>
      <p class="subtitle">Users allowed before open</p>
      <form class="mb-3">
        <div class="field has-addons">
          <div class="control is-expanded">
            <input class="input" type="url" name="url" required>
          </div>
          <div class="control">
            <button class="button is-info">Add</button>
          </div>
        </div>
      </form>
      {% if client.test_users|length %}
      <table class="table has-text-centered">
        <thead>
          <th>Testers</th>
          <td>Action</td>
        </thead>
        <tbody>
          {% for tester in test_users %}
          <tr>
            <td>{{ tester.email }}</td>
            <td><button class="tag is-danger">Remove</button></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="is-size-5 has-text-warning">No testers invited</h3>
      {% endif %}
    </section>
  </div>
</section>
<hr>
<section class="block px-6">
  <a class="button is-clickable is-danger" href="{% url 'oauth:delete' client.pk %}">Delete</a>
</section>
{% comment %} modal {% endcomment %}
<div id="rename-client-modal" class="modal">
  <div class="modal-background"></div>

  <div class="modal-content">
    <div class="box">
      <p>Modal JS example</p>
      <button class="delete" aria-label="close"></button>
      <!-- Your content -->
    </div>
  </div>
</div>

{% endblock content %}

{% block script %}
<script>
const openModal = (modalElem) => modalElem.classList.add('is-active')

const closeModal = (modalElem) => modalElem.classList.remove('is-active')

const closeAllModals = () => (document.querySelectorAll('.modal') || []).forEach((modalElem) => closeModal(modalElem))

document.getElementById('rename-client-modal-button').addEventListener('click', (event) => {
  const target = event.target
  const modalId =  target.dataset.modalTarget
  const modal = document.getElementById(modalId)
  openModal(modal)
  modal.querySelector('button.delete').addEventListener('click', () => {
    closeModal(modal)
  }, {once: true})
})

document.addEventListener('keydown', (event) => {
  if(event.key === "Escape") {
    closeAllModals();
  }
});
</script>
{% endblock script %}
